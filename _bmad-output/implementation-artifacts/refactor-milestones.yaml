generated: 2026-02-25
owner: platform-tenant-refactor
scope_freeze:
  enabled: true
  rule: "仅允许结构重构与一致性治理；禁止顺手引入新功能、语义变更或运行时兼容层。"
  blocked_changes:
    - "新增业务能力或产品需求"
    - "用户可见行为语义变更"
    - "数据语义变更（除重构必需修复）"
    - "映射适配层/兼容壳/双写过渡层"
  escalation:
    - "超出本 spec 的变更必须新开 spec 或审批记录"
    - "未通过当前里程碑出场条件不得进入下一里程碑"

milestones:
  - id: M1
    title: 契约与门禁建立
    tasks:
      - 1
      - 2
      - 14
      - 15
      - 17
      - 19
      - 21
    entry_criteria:
      - "tech-spec 已冻结，范围与验收标准明确"
      - "platform/tenant 目标目录蓝图确认"
    exit_criteria:
      - "check-domain-symmetry 已接入 API/Web 并可阻断"
      - "跨域 import 与 deep-import 门禁生效"
      - "capability schema v2 校验生效"
      - "导入迁移 codemod 可 dry-run"
    status: completed

  - id: M2
    title: API 重构完成并过门禁
    tasks:
      - 3
      - 4
      - 5
      - 6
      - 7
      - 8
      - 18
    entry_criteria:
      - "M1 完成且门禁稳定通过"
      - "API 重构任务清单按模块拆解完成"
    exit_criteria:
      - "http-routes 仅保留组合与绑定职责"
      - "route-manifest/route-permissions 链路通过检查"
      - "API 合同快照与数据不变量门禁可阻断"
      - "关键 API 回归通过（platform/tenant/auth/audit）"
    status: completed

  - id: M3
    title: Web 重构完成并过门禁
    tasks:
      - 9
      - 10
      - 11
      - 22
    entry_criteria:
      - "M2 完成并冻结"
      - "Web 双域菜单与路由边界基线明确"
    exit_criteria:
      - "shared-kernel HTTP 客户端模板收口"
      - "platform/tenant 前端目录迁移完成"
      - "deterministic test harness 生效"
      - "Web 关键流程回归通过"
    status: completed

  - id: M4
    title: 命名空间收口与清理完成
    tasks:
      - 12
      - 13
      - 16
      - 20
    entry_criteria:
      - "M3 完成并冻结"
      - "迁移差异清单与风险评审通过"
    exit_criteria:
      - "旧 modules/features 业务引用清零"
      - "无兼容层/映射层残留"
      - "全量 lint/test/check 脚本通过"
      - "文档与差异说明归档完成"
    status: completed
